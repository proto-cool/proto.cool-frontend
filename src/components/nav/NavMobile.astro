---
import SiteConfig from "@/site.config";
import Logo from "../logo/Logo.astro";
import NavLink from "./NavLink.astro";
import ThemeButton from "./buttons/ThemeButton.astro";
---

<div id="navigation-mobile" role="dialog" aria-modal="true" class="hidden">
    <!-- Background backdrop, show/hide based on slide-over state. -->
    <div id="navigation-mobile-backdrop" class="fixed inset-0 z-50 bg-black/50"></div>
    <div
        class="fixed inset-y-0 right-0 z-50 w-full overflow-y-auto bg-theme-bg-primary px-6 pb-6 pt-0 sm:max-w-sm sm:ring-1 sm:ring-theme-bg-tertiary"
    >
        <div class="flex items-center justify-between h-8 mt-8">
            <Logo />
            <div class="flex gap-x-8 items-center">
                <ThemeButton />
                <button
                    id="navigation-mobile-close"
                    type="button"
                    class="text-theme-fg-primary w-8 h-8"
                >
                    <span class="sr-only">Close menu</span>
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                        fill="currentColor"
                        class="size-8"
                    >
                        <path
                            fill-rule="evenodd"
                            d="M5.47 5.47a.75.75 0 0 1 1.06 0L12 10.94l5.47-5.47a.75.75 0 1 1 1.06 1.06L13.06 12l5.47 5.47a.75.75 0 1 1-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 0 1-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 0 1 0-1.06Z"
                            clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
        <div class="mt-6 flow-root">
            <div class="-my-6">
                <div class="space-y-2 py-6 flex flex-col gap-4 items-start">
                    {
                        SiteConfig.navLinks.map((link) => (
                            <NavLink text={link.text} href={link.href} type="mobile" />
                        ))
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    import { doc } from "prettier";

    let navElement: HTMLElement | null;
    let openBtnElement: HTMLElement | null;
    let closeBtnElement: HTMLElement | null;
    let backdropElement: HTMLElement | null;

    function toggleMobileNav(event: Event) {
        if (navElement)
            if (!navElement.classList.contains("block")) {
                navElement.classList.remove("hidden");
                navElement.classList.add("block");
            } else {
                navElement.classList.remove("block");
                navElement.classList.add("hidden");
            }
        event.preventDefault();
        return false;
    }

    function initMobileNav() {
        navElement = document.getElementById("navigation-mobile");
        openBtnElement = document.getElementById("navigation-mobile-open");
        closeBtnElement = document.getElementById("navigation-mobile-close");
        backdropElement = document.getElementById("navigation-mobile-backdrop");

        if (openBtnElement && closeBtnElement && backdropElement) {
            openBtnElement.addEventListener("click", toggleMobileNav);
            closeBtnElement.addEventListener("click", toggleMobileNav);
            backdropElement.addEventListener("click", toggleMobileNav);
        }
    }

    // runs on initial page load
    initMobileNav();

    // runs on view transitions navigation
    document.addEventListener("astro:after-swap", initMobileNav);
</script>
