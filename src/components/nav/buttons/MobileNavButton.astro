---
interface Props {
    class?: string;
}

const { class: className } = Astro.props;
---

<style>
    @reference "@/styles/main.css";

    #mobile-nav-toggle {
        @apply text-theme-fg-primary cursor-pointer;
    }

    .hamburger-line {
        @apply col-start-1 row-start-1 h-0.5 w-full bg-current transition-all duration-300 ease-in-out;
    }

    /* Hamburger positions (closed state) */
    .line-1 { @apply -translate-y-1.5; }
    .line-2 { @apply opacity-100; }
    .line-3 { @apply translate-y-1.5; }

    /* X positions (mobile-open state) */
    :global(.group[data-nav-state="mobile-open"]) .line-1 {
        @apply translate-y-0 rotate-45;
    }
    :global(.group[data-nav-state="mobile-open"]) .line-2 {
        @apply opacity-0;
    }
    :global(.group[data-nav-state="mobile-open"]) .line-3 {
        @apply translate-y-0 -rotate-45;
    }
</style>

<button id="mobile-nav-toggle" type="button" class:list={["relative flex items-center justify-center", className]}>
    <span class="sr-only">Toggle navigation menu</span>
    <div class="grid h-full w-full place-items-center pointer-events-none">
        <span class="hamburger-line line-1"></span>
        <span class="hamburger-line line-2"></span>
        <span class="hamburger-line line-3"></span>
    </div>
</button>

<script is:inline>
    function initMobileNav() {
        const nav = document.getElementById("nav");
        const toggleButton = document.getElementById("mobile-nav-toggle");

        if (toggleButton && nav) {
            toggleButton.addEventListener("click", () => {
                const currentState = nav.getAttribute("data-nav-state");
                if (currentState === "mobile-open") {
                    nav.setAttribute("data-nav-state", "closed");
                    window.dispatchEvent(new Event('scroll'));
                } else {
                    nav.setAttribute("data-nav-state", "mobile-open");
                }
            });
        }
    }

    // runs on view transitions navigation
    document.addEventListener("astro:page-load", initMobileNav);
</script>
