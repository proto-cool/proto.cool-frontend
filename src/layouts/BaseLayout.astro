---
// component imports
import Head from "@layouts/components/Head.astro";
import Nav from "@components/nav/Nav.astro";
import Footer from "@components/footer/Footer.astro";
import Noise from "@components/core/Noise.astro";

// style import
import "@/styles/main.css";

// data
import SiteConfig, { type ContentType } from "@/site.config";
import type { Post } from "@lib/payload/payload-types";

// heroImage and authorData are defined on blog posts
// authorData could also be defined on the about author page
interface Props {
    type?: ContentType;
    title: string;
    description?: string;
    post?: Post;
    noindex?: boolean; // you need to opt-in to no indexing, as it hides the page from search engines
}

const {
    type = "base",
    title,
    description = undefined,
    post,
    noindex = false,
} = Astro.props as Props;
---

<!doctype html>
<html lang="en" transition:animate="fade">
    <Head
        type={type}
        title={title}
        post={post ? post : undefined}
        noindex={noindex}
        description={description}
    />
    <body
        class:list={[
            "overflow-y-scroll",
            "flex",
            "flex-col",
            "min-h-[100vh]",
            {
                "use-animations": SiteConfig.useAnimations === true,
            },
        ]}
    >
        <div class="flex min-h-[100lvh] flex-col justify-between relative">
            <Nav />
            <main class="mx-auto container px-6 lg:px-8 flex-grow pt-40 pb-8 lg:pb-16">
                <slot />
            </main>
            <Footer />
            <Noise />
        </div>

        <script is:inline>
            const handleToggleClick = () => {
                const element = document.documentElement;
                element.classList.toggle("dark");

                const isDark = element.classList.contains("dark");
                localStorage.setItem("theme", isDark ? "dark" : "light");
            };

            const setupThemeToggles = () => {
                const themeButtons = document.querySelectorAll("[data-theme-toggle]");

                themeButtons.forEach((button) => {
                    button.addEventListener("click", handleToggleClick);
                });
            };

            document.addEventListener("astro:after-swap", function () {
                if (window.getTheme() === "dark")
                    document.documentElement.classList.toggle("dark", true);

                setupThemeToggles();
            });

            setupThemeToggles();
        </script>

        <!-- Scroll animations -->
        <script>
            import onview from "@lib/onview/onview";

            document.addEventListener("astro:after-swap", function () {
                const body = document.querySelector("body");
                if (body!.classList.contains("use-animations")) onview.enable();
            });
            const body = document.querySelector("body");
            if (body!.classList.contains("use-animations")) onview.enable();
        </script>
    </body>
</html>
