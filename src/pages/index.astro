---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Hero from "@/components/hero/Hero.astro";
import SiteConfig from "@/site.config";
import Card from "@components/core/Card.astro";
import TagCloud from "@components/blog/tags/TagCloud.astro";
import PostOverview from "@components/blog/PostOverview.astro";
import Button from "@components/core/Button.astro";

import { getNPosts } from "@lib/payload/utils";

const posts = await getNPosts(5);
---

<BaseLayout title={SiteConfig.title} description={SiteConfig.description}>
    <Hero />
    <section class="mt-16 w-full lg:grid lg:grid-cols-3 gap-8">
        <div
            class:list={[
                "text-base-content text-base",
                "lg:col-span-2 lg:col-start-1",
                "flex flex-col items-start",
            ]}
        >
            <h2 class="h2 pb-4">
                recent blog <span class="text-theme-color-primary">posts</span>
            </h2>
            <div
                class="flex flex-col gap-12 mt-8 border-l-0 lg:border-l-2 border-theme-bg-tertiary pl-0 lg:pl-4"
            >
                {posts.map((post) => <PostOverview post={post} />)}
            </div>
            <Button variant="secondary" arrow="right" href="/blog/1/" class="mt-8 lg:mt-12"
                >see more blog posts</Button
            >
        </div>

        <!--Tag content & sidebar-->
        <aside class="col-span-3 mt-8 lg:col-span-1 lg:mt-0 flex flex-col gap-8">
            <Card
                title="currently building"
                icon={`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-4 text-theme-color-primary"><path fill-rule="evenodd" d="M14.615 1.595a.75.75 0 0 1 .359.852L12.982 9.75h7.268a.75.75 0 0 1 .548 1.262l-10.5 11.25a.75.75 0 0 1-1.272-.71l1.992-7.302H3.75a.75.75 0 0 1-.548-1.262l10.5-11.25a.75.75 0 0 1 .913-.143Z" clip-rule="evenodd" /></svg>`}
                class="bg-theme-bg-secondary border border-theme-bg-tertiary"
            >
                <div class="flex flex-col gap-5">
                    <div>
                        <h4 class="text-lg font-medium lowercase text-theme-fg-primary">proto.cool v2.0</h4>
                        <p class="text-sm description mt-1">building a fancy new personal site with astro & payload cms.</p>
                    </div>

                    <div class="space-y-2.5">
                        <div class="flex justify-between text-[10px] lowercase tracking-widest font-bold text-theme-fg-tertiary">
                            <span>progress</span>
                            <span>85%</span>
                        </div>
                        <div class="h-2 w-full bg-theme-bg-tertiary rounded-full overflow-hidden p-0.5">
                            <div 
                                class="h-full bg-theme-color-primary rounded-full relative overflow-hidden" 
                                style="width: 85%"
                            >
                                <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full animate-[shimmer_2s_infinite]"></div>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center gap-3 text-xs lowercase font-medium text-theme-fg-secondary bg-theme-bg-tertiary/30 w-fit px-3 py-1.5 rounded-full border border-theme-bg-tertiary/50">
                        <span class="relative flex h-2 w-2">
                            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-theme-color-primary opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-2 w-2 bg-theme-color-primary"></span>
                        </span>
                        <span>latest: bikeshedding</span>
                    </div>

                    <Button variant="primary" size="sm" arrow="right" href="https://github.com/proto-cool/proto.cool-frontend/commits/main/" class="w-fit">
                        view log
                    </Button>
                </div>
            </Card>
            <Card
                title="post tags"
                icon={`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-4 text-theme-color-primary"><path fill-rule="evenodd" d="M5.25 2.25a3 3 0 0 0-3 3v4.318a3 3 0 0 0 .879 2.121l9.58 9.581c.92.92 2.39.92 3.31 0l4.318-4.317a2.341 2.341 0 0 0 0-3.31l-9.581-9.58a3 3 0 0 0-2.121-.879H5.25ZM6.5 7.5a1 1 0 1 1 2 0 1 1 0 0 1-2 0Z" clip-rule="evenodd" /></svg>`}
                class="sticky top-32 w-full bg-transparent border border-theme-bg-tertiary"
            >
                <TagCloud showCount={true} />
            </Card>
        </aside>
    </section>
</BaseLayout>
